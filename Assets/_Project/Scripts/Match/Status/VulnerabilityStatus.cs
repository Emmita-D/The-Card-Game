using Game.Match.Units;

namespace Game.Match.Status
{
    /// <summary>
    /// Time-limited debuff that causes the unit to take extra damage,
    /// by increasing StatModifier.damageTakenMultiplier.
    ///
    /// Example:
    ///   new VulnerabilityStatus(5f, 1.25f)
    ///   -> for 5 seconds this unit takes 25% more damage.
    /// </summary>
    public class VulnerabilityStatus : StatusEffect
    {
        private float remainingDuration;
        private readonly float vulnerabilityMultiplier;

        // Optional: nice name for logs / future UI.
        public override string Name => "Vulnerability";

        /// <param name="durationSeconds">How long the vulnerability lasts.</param>
        /// <param name="damageTakenMultiplier">
        ///   Final multiplicative factor for damage taken.
        ///   1.0f = no change, 1.25f = +25% damage taken, 1.5f = +50%, etc.
        /// </param>
        public VulnerabilityStatus(float durationSeconds, float damageTakenMultiplier)
        {
            remainingDuration = durationSeconds;
            vulnerabilityMultiplier = damageTakenMultiplier <= 0f ? 1f : damageTakenMultiplier;
        }

        /// <summary>
        /// Called every frame by UnitStatusController.
        /// We just tick down the remaining duration and mark IsExpired when done.
        /// </summary>
        public override void OnUpdate(UnitRuntime owner, float deltaTime)
        {
            if (IsExpired)
                return;

            remainingDuration -= deltaTime;
            if (remainingDuration <= 0f)
            {
                remainingDuration = 0f;
                IsExpired = true;
            }
        }

        /// <summary>
        /// Contributes a StatModifier that increases damageTakenMultiplier
        /// while the status is active.
        /// </summary>
        public override StatModifier GetStatModifier()
        {
            if (IsExpired)
                return StatModifier.None;

            // Start from "no change" and only touch damageTakenMultiplier.
            StatModifier modifier = StatModifier.None;
            modifier.damageTakenMultiplier = vulnerabilityMultiplier;

            return modifier;
        }

        // We don't need special behavior on attack or turns for this status,
        // so we just inherit the defaults for OnOwnerAttack / OnTurnAdvanced.
    }
}
